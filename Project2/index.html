<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Project 2</title>

<style type="text/css">
div.inline { float:left; width:33%; margin-right:auto; }
.clearBoth { clear:both; }
div.spacer { float:left; width:50%; margin-right:auto;}
</style>

<script src="webgl-utils.js"></script>
<script src="webgl-debug.js"></script>
<script src="cuon-utils.js"></script>
<script src="cuon-matrix.js"></script>
<script src="renderable.js"></script>
<script src="camera.js"></script>
<script src="events.js"></script>
<script src="shaders.js"></script>
<script type="text/javascript">
	//This function gets called when reading a JSON file. It stores the current xml information.
	function parseJSON(jsonFile)
	{
		var	xhttp = new XMLHttpRequest();
		xhttp.open("GET", jsonFile, false);
		xhttp.overrideMimeType("application/json");
		xhttp.send(null);	
		var Doc = xhttp.responseText;
		return JSON.parse(Doc);
	}
	
	// Switch between buildings
	var gl;
	var model, camera, lightType, cameraEye, lookAt, projMatrix;
	var canvas = null;
	function loadModel(modelfilename)
	{
		model = new RenderableModel(gl,parseJSON(modelfilename));
		camera = new Camera(gl,model.getBounds(),[0,1,0]);
		projMatrix = camera.getProjMatrix();
	}
	
	// change light source
	function loadLight(type) { lightType = type; }

	function activateDemoMode(box)
	{
		if (box.checked === true) 
		{
			console.log("box is true!");
			canvas.width  = window.innerWidth * 0.8;
	  		canvas.height = window.innerHeight * 0.8;
		}
		else
		{
			canvas.height = 400;
			canvas.width = 600;
		}
		localStorage.demoMode = box.checked;
	}
	
	// onload: draw scene
	function start() {
		//var canvas = null;
		canvas = document.getElementById("scene");
		console.log(((canvas)?"Canvas acquired":"Error: Can not acquire canvas"));
		
		var box = document.getElementById("demoMode");
		if (localStorage.demoMode == 'true')
		{
			console.log("localStorage was true");
			box.checked = true;
		}
		else
		{
			box.checked = false;
		}

		activateDemoMode(box);
		gl = getWebGLContext(canvas);
		
		// default model to first one in dropdown men
		var modelList = document.getElementById("modelList");
		loadModel(modelList.options[modelList.selectedIndex].value);
	
		var lightList = document.getElementById("lightList");
		loadLight(lightList.options[lightList.selectedIndex].value);
		
		// update drawing as fast as possible
		function draw(){
			gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);
			
			// get scene updates
			viewMatrix = camera.getViewMatrix();
			projMatrix = camera.getProjMatrix();
			cameraEye = camera.getCameraPosition();
			lookAt = camera.getLookAtPoint();
			model.draw(lightType,cameraEye, lookAt, projMatrix, viewMatrix);	
			
			window.requestAnimationFrame(draw);
		}

		gl.clearColor(1,1,1,1);
		gl.enable(gl.DEPTH_TEST);
		draw();
		localStorage.demoMode = box.checked;
		return 1;
	}
</script>
</head>
<body onload="start();">
<center>
	<h1> CAP4720 Project 2 </h1>
	Demo Mode: <input id="demoMode" type="checkbox" onchange="activateDemoMode(this)">
	<br />
	<canvas id="scene" width="600px" height="400px" style="border:1px solid #FF0000;"></canvas>
	<br />
	<h3><u> Keyboard controls </u></h3>
	<div class="inline">
		<h4>Move:</h4>
		<p>Move Forward: W</p><p>Move Backward: S</p><p>Move Left: A</p><p>Move Right: D</p><p>Move Up: E</p><p>Move Down: Q</p> 
	</div>
	<div class="inline">
		<h4>Zoom:</h4>
		<p>Zoom In: +</p><p>Zoom Out: â€“</p> 
	</div>
	<div class="inline">
		<h4>Rotate:</h4>
		<p>Rotate Up: I</p><p>Rotate Down: K</p><p>Rotate Left: J</p><p>Rotate Right: L</p>
	</div>
	<br class="clearBoth" />
	<select id="modelList" onchange="loadModel(this.value);">
  		<!-- <option value='DijonPalais/models/model.json'>Dijon Palais</option> -->
  		<option value='House/models/model.json'>House</option>
  		<option value='House_of_parliament/models/model.json'>House of Parliament</option>
  		<option value='Shrine/models/model.json'>Shrine</option>
 	</select>
 	<select id="lightList" onchange="loadLight(this.value);">
  		<!-- <option value='DijonPalais/models/model.json'>Dijon Palais</option> -->
  		<option value='1'>Omni Light</option>
  		<option value='0'>Spot Light</option>
 	</select>
</center>
</body>
</html>
